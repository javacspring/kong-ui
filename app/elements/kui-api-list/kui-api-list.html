<!--
@license
Copyright (c) 2015 Mike Saraf. All rights reserved.
This code may only be used under the BSD style license found in the included file LICENSE.md
-->

<dom-module id="kui-api-list">
  <link rel="stylesheet" href="kui-api-list.css">
  <template>
    <iron-ajax
      id="ajaxAPI"
      handle-as="json"
      on-response="handleAPIResponse"
      debounce-duration="300"></iron-ajax>

    <ul>
      <template is="dom-repeat" items="{{items}}">
        <li class="foo">
          <paper-material api-card id="{{item.name}}" on-tap="editAPI">

            <paper-icon-button icon="chevron-right"></paper-icon-button>

            <div name>
              <span key>name</span>
              <span value>{{item.name}}</span>
            </div>

            <div endpoint>
              <span key>Endpoint (public_dns + path)</span>
              <span value><span>{{item.public_dns}}</span><span>{{item.path}}</span></span>
            </div>

          </paper-material>
        </li>
      </template>
    </ul>
  </template>

  <script>
    (function() {
      Polymer({
        is: 'kui-api-list',

        listeners: {
        },

        properties: {
          selected:{type: String, notify: true},
          server:{type: String, observer: 'serverChanged'}
        },

        /* --- Observer Methods --- */
        serverChanged: function(e) {
          this.$.ajaxAPI.url = this.server + "/apis";
          this.$.ajaxAPI.generateRequest();
        },

        /* --- Lifecycle Methods --- */
        ready: function() {
        },

        /* --- Private Methods --- */

        handleAPIResponse : function(e){
          if(e.detail.parseResponse() != null)
            this.items = e.detail.parseResponse().data;
        },

        /* --- Public Methods --- */

        editAPI : function(e){
          this.selected = e.currentTarget.id;
          this.fire('on-selected', {value: this.selected});
        }

      });
    })();
  </script>

</dom-module>
