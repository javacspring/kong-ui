<!--
@license
Copyright (c) 2015 Mike Saraf. All rights reserved.
This code may only be used under the BSD style license found in the included file LICENSE.md
-->

<dom-module id="kui-api-list">
  <link rel="stylesheet" href="kui-api-list.css">
  <template>
    <iron-ajax
      id="ajaxAPI"
      handle-as="json"
      on-response="handleAPIResponse"
      debounce-duration="300"></iron-ajax>

    <ul>
      <template is="dom-repeat" items="{{items}}">
        <li class="foo">
          <paper-material api-card>

            <paper-icon-button icon="chevron-right"></paper-icon-button>

            <div name>
              <span key>name</span>
              <span value>{{item.name}}</span>
            </div>

            <div endpoint>
              <span key>Endpoint (public_dns + path)</span>
              <span value><span>{{item.public_dns}}</span><span>{{item.path}}</span></span>
            </div>

          </paper-material>
        </li>
      </template>
    </ul>
  </template>

  <script>
    (function() {
      Polymer({
        is: 'kui-api-list',

        listeners: {
        },

        properties: {
          server:{type: String, observer: 'serverChanged'}
        },

        /* --- Observer Methods --- */
        serverChanged: function(e) {
          this.$.ajaxAPI.url = this.server + "/apis";
          this.$.ajaxAPI.generateRequest();
        },

        /* --- Lifecycle Methods --- */
        ready: function() {

          this.items = [
            {
              "id": "4d924084-1adb-40a5-c042-63b19db421d1",
              "name": "Mockbin",
              "public_dns": "mockbin.com",
              "path": "/",
              "target_url": "https://mockbin.com",
              "created_at": 1422386534
            },
            {
              "id": "3f924084-1adb-40a5-c042-63b19db421a2",
              "name": "PrivateAPI",
              "public_dns": "internal.api.com",
              "path":"/secret",
              "target_url": "http://private.api.com",
              "created_at": 1422386585
            },
            {
              "id": "2f924084-1adb-40a5-c042-63b19db421a2",
              "name": "ReallyReallyLongNameExample",
              "public_dns": "thisisareallylong.nameforadomain.com",
              "path":"/thispathissolong/absurd",
              "target_url": "http://private.api.com",
              "created_at": 1422386585
            }
          ];
        },

        /* --- Private Methods --- */

        handleAPIResponse : function(e){
          if(e.detail.parseResponse() != null)
            this.items = e.detail.parseResponse().data;
        }

        /* --- Public Methods --- */
      });
    })();
  </script>

</dom-module>
